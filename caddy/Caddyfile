http://{$DOMAIN} {
    redir https://{$DOMAIN}{uri} permanent
}

{$DOMAIN} {
    # Backend API - proxy to FastAPI (preserve /api prefix)
    # Note: This path must match NEXT_PUBLIC_API_URL build arg (default: /api)
    handle /api/* {
        reverse_proxy {$BACKEND_API_HOST}:{$BACKEND_API_PORT}
    }

    # Client - serve Next.js app
    handle {
        reverse_proxy client:3000
    }
}
