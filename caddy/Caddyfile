http://{$DOMAIN} {
    redir https://{$DOMAIN}{uri} permanent
}

{$DOMAIN} {
    # Backend API - proxy to FastAPI (strip /api prefix)
    handle_path {$API_PATH}/* {
        reverse_proxy {$BACKEND_API_HOST}:{$BACKEND_API_PORT}
    }

    # Client - serve Next.js app
    handle {
        reverse_proxy client:3000
    }
}

http://{$STREAMLIT_DOMAIN} {
    redir https://{$STREAMLIT_DOMAIN}{uri} permanent
}

{$STREAMLIT_DOMAIN} {
    reverse_proxy {$STREAMLIT_HOST}:{$STREAMLIT_PORT}
}
